<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buena Vista Wedding Guide Map</title>
    <script src='https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.css' rel='stylesheet' />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }
        
        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }
        
        .header {
            position: absolute;
            top: 20px;
            left: 20px;
            background: white;
            padding: 20px 25px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1;
            max-width: 320px;
        }
        
        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
            color: #333;
        }
        
        .header p {
            font-size: 14px;
            color: #666;
        }
        
        .mapboxgl-popup-content {
            padding: 15px;
            max-width: 300px;
        }
        
        .popup-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 8px;
            color: #333;
        }
        
        .popup-note {
            font-size: 14px;
            line-height: 1.5;
            color: #555;
            margin-bottom: 12px;
        }
        
        .popup-links {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .popup-link {
            font-size: 13px;
            color: #2c7fb8;
            text-decoration: none;
            padding: 6px 12px;
            border: 1px solid #2c7fb8;
            border-radius: 6px;
            transition: all 0.2s;
        }
        
        .popup-link:hover {
            background: #2c7fb8;
            color: white;
        }
        
        .favorite-badge {
            color: #f39c12;
            font-size: 16px;
            margin-left: 5px;
        }
        
        @media (max-width: 768px) {
            .header {
                max-width: calc(100% - 40px);
            }
            
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üéâ Buena Vista Wedding Guide</h1>
        <p>Our favorite spots in town!</p>
    </div>
    
    <div id="map"></div>

    <script>
        // Replace 'YOUR_MAPBOX_TOKEN' with your actual Mapbox access token
        // Get one free at https://account.mapbox.com/
        mapboxgl.accessToken = 'pk.eyJ1IjoiamhmaXNjaGVyNCIsImEiOiJjbWt4am5nY28wYWM2M21xN3cxM2EyN2NlIn0.opIjp5BYtkUvbrBAJLgMYw';
        
        const map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/streets-v12',
            center: [-105.8, 39.2], // Centered to show all airport routes
            zoom: 8
        });
        
        // Add navigation controls
        map.addControl(new mapboxgl.NavigationControl(), 'top-right');
        
        map.on('load', () => {
            // Draw airport routes (visible when zoomed out)
            const routeData = {
                type: 'FeatureCollection',
                features: [
                    {
                        type: 'Feature',
                        properties: { label: 'Denver  ~2.5 hrs' },
                        geometry: {
                            type: 'LineString',
                            coordinates: [
                                [-104.6737, 39.8561],
                                [-104.88,   39.74],
                                [-105.07,   39.60],
                                [-105.35,   39.48],
                                [-105.68,   39.34],
                                [-105.99,   39.22],
                                [-106.08,   38.97],
                                [-106.119,  38.843]
                            ]
                        }
                    },
                    {
                        type: 'Feature',
                        properties: { label: 'Colorado Springs  ~2 hrs' },
                        geometry: {
                            type: 'LineString',
                            coordinates: [
                                [-104.7006, 38.8058],
                                [-104.92,   38.86],
                                [-105.06,   38.99],
                                [-105.20,   38.94],
                                [-105.43,   38.94],
                                [-105.59,   39.04],
                                [-105.81,   38.98],
                                [-106.04,   38.88],
                                [-106.119,  38.843]
                            ]
                        }
                    },
                    {
                        type: 'Feature',
                        properties: { label: 'Denver via I-70 & Leadville  ~2h 45m' },
                        geometry: {
                            type: 'LineString',
                            coordinates: [
                                [-104.6737, 39.8561],
                                [-104.95,   39.75],
                                [-105.35,   39.74],
                                [-105.89,   39.68],
                                [-106.07,   39.63],
                                [-106.16,   39.50],
                                [-106.24,   39.38],
                                [-106.29,   39.25],
                                [-106.29,   39.08],
                                [-106.119,  38.843]
                            ]
                        }
                    },
                    {
                        type: 'Feature',
                        properties: { label: 'Gunnison  ~1 hr' },
                        geometry: {
                            type: 'LineString',
                            coordinates: [
                                [-106.9356, 38.5372],
                                [-106.67,   38.54],
                                [-106.33,   38.49],
                                [-106.08,   38.52],
                                [-106.08,   38.72],
                                [-106.119,  38.843]
                            ]
                        }
                    }
                ]
            };

            map.addSource('routes', { type: 'geojson', data: routeData });

            // Casing (white outline) for readability
            map.addLayer({
                id: 'routes-casing',
                type: 'line',
                source: 'routes',
                maxzoom: 11,
                layout: { 'line-join': 'round', 'line-cap': 'round' },
                paint: {
                    'line-color': '#ffffff',
                    'line-width': 6,
                    'line-opacity': 0.6
                }
            });

            // Main route line
            map.addLayer({
                id: 'routes-line',
                type: 'line',
                source: 'routes',
                maxzoom: 11,
                layout: { 'line-join': 'round', 'line-cap': 'round' },
                paint: {
                    'line-color': '#e07b00',
                    'line-width': 3,
                    'line-opacity': 0.85,
                    'line-dasharray': [4, 3]
                }
            });

            // Drive time labels along each route
            map.addLayer({
                id: 'routes-labels',
                type: 'symbol',
                source: 'routes',
                maxzoom: 11,
                layout: {
                    'symbol-placement': 'line-center',
                    'text-field': ['get', 'label'],
                    'text-size': 12,
                    'text-font': ['DIN Offc Pro Medium', 'Arial Unicode MS Bold'],
                    'text-offset': [0, -1]
                },
                paint: {
                    'text-color': '#e07b00',
                    'text-halo-color': '#ffffff',
                    'text-halo-width': 2
                }
            });

            // Add emoji markers for each place with cache busting
            fetch('./places.geojson?t=' + Date.now())
                .then(response => response.json())
                .then(data => {
                    console.log('Loaded ' + data.features.length + ' places from GeoJSON');
                    data.features.forEach((feature, index) => {
                        const props = feature.properties;
                        
                        // Create marker element
                        const el = document.createElement('div');
                        el.innerHTML = props.icon;
                        el.style.fontSize = props.name && props.name.trim() === 'Ceremony' ? '64px' : '40px';
                        el.style.cursor = 'pointer';
                        el.style.textShadow = '2px 2px 4px rgba(0,0,0,0.5)';
                        el.style.filter = 'drop-shadow(0 0 8px rgba(255,255,255,0.8))';
                        el.style.zIndex = props.name && props.name.trim() === 'Ceremony' ? '999' : '1';
                        
                        // Create popup HTML
                        const favoriteBadge = props.favorite === true || props.favorite === 'true' 
                            ? '<span class="favorite-badge">‚≠ê</span>' 
                            : '';
                        
                        const websiteLink = props.website 
                            ? `<a href="${props.website}" target="_blank" class="popup-link">Website</a>` 
                            : '';
                        
                        const googleMapsLink = props.googleMaps 
                            ? `<a href="${props.googleMaps}" target="_blank" class="popup-link">Google Maps</a>` 
                            : '';
                        
                        const popupHTML = `
                            <div class="popup-title">
                                ${props.icon} ${props.name}${favoriteBadge}
                            </div>
                            <div class="popup-note">${props.note}</div>
                            <div class="popup-links">
                                ${websiteLink}
                                ${googleMapsLink}
                            </div>
                        `;
                        
                        // Create popup
                        const markerPopup = new mapboxgl.Popup({
                            offset: 25,
                            closeButton: true,
                            closeOnClick: false
                        }).setHTML(popupHTML);
                        
                        // Add marker with popup (anchor set to center the emoji on coordinates)
                        new mapboxgl.Marker({
                            element: el,
                            anchor: 'center'
                        })
                            .setLngLat(feature.geometry.coordinates)
                            .setPopup(markerPopup)
                            .addTo(map);
                        
                        console.log((index + 1) + '. Added marker for: ' + props.name);
                    });
                })
                .catch(error => {
                    console.error('Error loading places.geojson:', error);
                });
        });
    </script>
</body>
</html>

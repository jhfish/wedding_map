<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buena Vista Wedding Guide Map</title>
    <script src='https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.css' rel='stylesheet' />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }
        
        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }
        
        .header {
            position: absolute;
            top: 20px;
            left: 20px;
            background: white;
            padding: 20px 25px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1;
            max-width: 320px;
        }
        
        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
            color: #333;
        }
        
        .header p {
            font-size: 14px;
            color: #666;
        }
        
        .mapboxgl-popup-content {
            padding: 15px;
            max-width: 300px;
        }
        
        .popup-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 8px;
            color: #333;
        }
        
        .popup-note {
            font-size: 14px;
            line-height: 1.5;
            color: #555;
            margin-bottom: 12px;
        }
        
        .popup-links {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .popup-link {
            font-size: 13px;
            color: #2c7fb8;
            text-decoration: none;
            padding: 6px 12px;
            border: 1px solid #2c7fb8;
            border-radius: 6px;
            transition: all 0.2s;
        }
        
        .popup-link:hover {
            background: #2c7fb8;
            color: white;
        }
        
        .favorite-badge {
            color: #f39c12;
            font-size: 16px;
            margin-left: 5px;
        }

        .mapboxgl-popup {
            z-index: 10000;
        }

        .mapboxgl-popup-close-button {
            font-size: 18px;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        @media (max-width: 768px) {
            .header {
                top: 12px;
                left: 12px;
                right: 12px;
                max-width: none;
                padding: 12px 16px;
            }

            .header h1 {
                font-size: 18px;
            }

            .header p {
                font-size: 12px;
            }

            .mapboxgl-popup-content {
                max-width: 80vw;
            }

            .popup-title {
                font-size: 16px;
            }

            .popup-link {
                padding: 8px 14px;
                font-size: 14px;
            }

            .mapboxgl-ctrl-top-right {
                top: 80px;
            }

            .mapboxgl-popup-close-button {
                font-size: 22px;
                width: 44px;
                height: 44px;
                display: flex;
                align-items: center;
                justify-content: center;
                top: 0;
                right: 0;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üéâ Buena Vista Wedding Guide</h1>
        <p>Our favorite spots in town!</p>
    </div>
    
    <div id="map"></div>

    <script>
        // Replace 'YOUR_MAPBOX_TOKEN' with your actual Mapbox access token
        // Get one free at https://account.mapbox.com/
        mapboxgl.accessToken = 'pk.eyJ1IjoiamhmaXNjaGVyNCIsImEiOiJjbWt4am5nY28wYWM2M21xN3cxM2EyN2NlIn0.opIjp5BYtkUvbrBAJLgMYw';
        
        const map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/streets-v12',
            center: [-105.8, 39.2], // Centered to show all airport routes
            zoom: 8
        });
        
        // Add navigation controls
        map.addControl(new mapboxgl.NavigationControl(), 'top-right');
        
        map.on('load', () => {
            // Draw airport routes (visible when zoomed out)
            const routeData = {
                type: 'FeatureCollection',
                features: [
                    {
                        type: 'Feature',
                        properties: { label: 'Denver  ~2.5 hrs' },
                        geometry: {
                            type: 'LineString',
                            coordinates: [
                                [-104.6737, 39.8561], // DEN
                                [-104.90,   39.73],   // I-70 west through Denver
                                [-105.11,   39.65],   // C-470/I-70 junction
                                [-105.13,   39.57],   // US-285 / C-470 junction
                                [-105.51,   39.48],   // Conifer
                                [-105.48,   39.41],   // Bailey
                                [-105.76,   39.43],   // Kenosha Pass
                                [-106.00,   39.22],   // Fairplay
                                [-106.00,   39.05],   // South on 285
                                [-105.99,   38.88],   // Antero Junction (US-285 & US-24)
                                [-106.119,  38.843]   // BV
                            ]
                        }
                    },
                    {
                        type: 'Feature',
                        properties: { label: 'Colorado Springs  ~2 hrs' },
                        geometry: {
                            type: 'LineString',
                            coordinates: [
                                [-104.7006, 38.8058], // COS airport
                                [-104.85,   38.83],   // West through CS on US-24
                                [-104.918,  38.858],  // Manitou Springs
                                [-105.058,  38.994],  // Woodland Park
                                [-105.201,  38.944],  // Divide
                                [-105.287,  38.932],  // Florissant
                                [-105.540,  38.972],  // Lake George
                                [-105.799,  38.989],  // Hartsel
                                [-105.99,   38.88],   // Antero Junction (US-285 & US-24)
                                [-106.119,  38.843]   // BV
                            ]
                        }
                    },
                    {
                        type: 'Feature',
                        properties: { label: 'Denver via I-70 & Leadville  ~2h 45m' },
                        geometry: {
                            type: 'LineString',
                            coordinates: [
                                [-104.6737, 39.8561], // DEN
                                [-104.90,   39.74],   // I-70 west
                                [-105.22,   39.75],   // Golden
                                [-105.515,  39.742],  // Idaho Springs
                                [-105.698,  39.706],  // Georgetown
                                [-105.899,  39.681],  // Eisenhower Tunnel
                                [-106.069,  39.629],  // Dillon/Silverthorne
                                [-106.158,  39.503],  // Copper Mountain
                                [-106.213,  39.402],  // CO-91 south junction
                                [-106.292,  39.250],  // Leadville
                                [-106.29,   39.08],   // South on US-24
                                [-106.119,  38.843]   // BV
                            ]
                        }
                    },
                    {
                        type: 'Feature',
                        properties: { label: 'Gunnison  ~1 hr' },
                        geometry: {
                            type: 'LineString',
                            coordinates: [
                                [-106.9356, 38.5372], // Gunnison airport
                                [-106.67,   38.543],  // East on US-50
                                [-106.467,  38.518],  // Parlin
                                [-106.333,  38.497],  // Monarch Pass summit
                                [-106.25,   38.482],  // East descent
                                [-106.082,  38.518],  // Poncha Springs
                                [-106.08,   38.72],   // North on 285
                                [-106.119,  38.843]   // BV
                            ]
                        }
                    }
                ]
            };

            map.addSource('routes', { type: 'geojson', data: routeData });

            // Casing (white outline) for readability
            map.addLayer({
                id: 'routes-casing',
                type: 'line',
                source: 'routes',
                maxzoom: 11,
                layout: { 'line-join': 'round', 'line-cap': 'round' },
                paint: {
                    'line-color': '#ffffff',
                    'line-width': 6,
                    'line-opacity': 0.6
                }
            });

            // Main route line
            map.addLayer({
                id: 'routes-line',
                type: 'line',
                source: 'routes',
                maxzoom: 11,
                layout: { 'line-join': 'round', 'line-cap': 'round' },
                paint: {
                    'line-color': '#e07b00',
                    'line-width': 3,
                    'line-opacity': 0.85,
                    'line-dasharray': [4, 3]
                }
            });

            // Drive time labels along each route
            map.addLayer({
                id: 'routes-labels',
                type: 'symbol',
                source: 'routes',
                maxzoom: 11,
                layout: {
                    'symbol-placement': 'line-center',
                    'text-field': ['get', 'label'],
                    'text-size': 12,
                    'text-font': ['DIN Offc Pro Medium', 'Arial Unicode MS Bold'],
                    'text-offset': [0, -1]
                },
                paint: {
                    'text-color': '#e07b00',
                    'text-halo-color': '#ffffff',
                    'text-halo-width': 2
                }
            });

            // Bridge to Bridge Trail ‚Äî real GPS data from MTB Project GPX
            map.addSource('trail-b2b', {
                type: 'geojson',
                data: {
                    type: 'Feature',
                    geometry: {
                        type: 'LineString',
                        coordinates: [
                            [-106.121982, 38.846998],
                            [-106.121596, 38.847061],
                            [-106.120904, 38.846361],
                            [-106.120949, 38.845809],
                            [-106.12059,  38.845368],
                            [-106.120158, 38.845011],
                            [-106.119422, 38.844283],
                            [-106.119036, 38.844374],
                            [-106.119045, 38.844116],
                            [-106.118919, 38.843892],
                            [-106.118604, 38.8435],
                            [-106.118488, 38.843276],
                            [-106.118191, 38.843045],
                            [-106.117976, 38.843136],
                            [-106.11802,  38.843017],
                            [-106.117976, 38.842667],
                            [-106.117868, 38.842527],
                            [-106.11767,  38.842506],
                            [-106.117715, 38.842338],
                            [-106.117661, 38.842205],
                            [-106.117428, 38.84201],
                            [-106.117329, 38.841856],
                            [-106.117095, 38.841772],
                            [-106.117005, 38.841688],
                            [-106.116889, 38.841667],
                            [-106.116907, 38.841429],
                            [-106.11679,  38.841289],
                            [-106.11732,  38.841086],
                            [-106.117284, 38.840967],
                            [-106.117347, 38.840855],
                            [-106.117185, 38.840757],
                            [-106.117014, 38.840057],
                            [-106.116898, 38.839827],
                            [-106.11696,  38.839792],
                            [-106.117095, 38.83998],
                            [-106.117185, 38.839987],
                            [-106.117266, 38.839757],
                            [-106.11723,  38.839631],
                            [-106.117005, 38.839449],
                            [-106.116916, 38.839337],
                            [-106.117005, 38.839246],
                            [-106.117185, 38.839246],
                            [-106.117257, 38.839176]
                        ]
                    }
                }
            });

            map.addLayer({
                id: 'trail-b2b-casing',
                type: 'line',
                source: 'trail-b2b',
                minzoom: 13,
                layout: { 'line-join': 'round', 'line-cap': 'round' },
                paint: { 'line-color': '#ffffff', 'line-width': 6, 'line-opacity': 0.6 }
            });

            map.addLayer({
                id: 'trail-b2b-line',
                type: 'line',
                source: 'trail-b2b',
                minzoom: 13,
                layout: { 'line-join': 'round', 'line-cap': 'round' },
                paint: { 'line-color': '#e03030', 'line-width': 3, 'line-opacity': 0.9 }
            });

            // Add emoji markers for each place with cache busting
            fetch('./places.geojson?t=' + Date.now())
                .then(response => response.json())
                .then(data => {
                    console.log('Loaded ' + data.features.length + ' places from GeoJSON');
                    data.features.forEach((feature, index) => {
                        const props = feature.properties;
                        
                        // Create marker element
                        const el = document.createElement('div');
                        el.innerHTML = props.icon;
                        el.style.fontSize = props.name && props.name.trim() === 'Ceremony' ? '64px' : '40px';
                        el.style.cursor = 'pointer';
                        el.style.textShadow = '2px 2px 4px rgba(0,0,0,0.5)';
                        el.style.filter = 'drop-shadow(0 0 8px rgba(255,255,255,0.8))';
                        el.style.zIndex = props.name && props.name.trim() === 'Ceremony' ? '999' : '1';
                        
                        // Create popup HTML
                        const favoriteBadge = props.favorite === true || props.favorite === 'true' 
                            ? '<span class="favorite-badge">‚≠ê</span>' 
                            : '';
                        
                        const websiteLink = props.website 
                            ? `<a href="${props.website}" target="_blank" class="popup-link">Website</a>` 
                            : '';
                        
                        const googleMapsLink = props.googleMaps
                            ? `<a href="${props.googleMaps}" target="_blank" class="popup-link">Google Maps</a>`
                            : '';

                        const popupHTML = `
                            <div class="popup-title">
                                ${props.icon} ${props.name}${favoriteBadge}
                            </div>
                            <div class="popup-note">${props.note}</div>
                            <div class="popup-links">
                                ${websiteLink}
                                ${googleMapsLink}
                            </div>
                        `;

                        // Create popup
                        const markerPopup = new mapboxgl.Popup({
                            offset: 25,
                            closeButton: true,
                            closeOnClick: false
                        }).setHTML(popupHTML);
                        
                        // Add marker with popup (anchor set to center the emoji on coordinates)
                        new mapboxgl.Marker({
                            element: el,
                            anchor: 'center'
                        })
                            .setLngLat(feature.geometry.coordinates)
                            .setPopup(markerPopup)
                            .addTo(map);
                        
                        console.log((index + 1) + '. Added marker for: ' + props.name);
                    });
                })
                .catch(error => {
                    console.error('Error loading places.geojson:', error);
                });
        });
    </script>
</body>
</html>
